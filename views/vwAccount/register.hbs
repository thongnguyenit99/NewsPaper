{{#section 'css'}}
    <style>
    .divider-text {
        position: relative;
        text-align: center;
        margin-top: 15px;
        margin-bottom: 15px;
    }
    .divider-text span {
        padding: 7px;
        font-size: 12px;
        position: relative;   
        z-index: 2;
    }
    .divider-text:after {
        content: "";
        position: absolute;
        width: 100%;
        border-bottom: 1px solid #ddd;
        top: 55%;
        left: 0;
        z-index: 1;
    }

    .btn-facebook {
        background-color: #405D9D;
        color: #fff;
    }
    .btn-twitter {
        background-color: #42AEEC;
        color: #fff;
    }
    .btn-google{
        background-color: #42e6ec;
        color: #fff;
    }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.min.css">
{{/section}}
{{#section 'js'}}
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.full.min.js"></script>
    <script></script>

    <script>
        $('#txtDOB').datetimepicker({
            format: 'm/d/Y',
            timepicker: false,
            mask: true,
        });

        $('#frmRegister').on('submit', function (e) {
            //alert('submit called');
            e.preventDefault();
            // if (validate())
            //   $('#frmRegister').off('submit').submit();
            validate();
        })

        function validateEmail(email) {
            const re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                return re.test(email);
        }

        function scorePassword(pass) {
            var score = 0;
            if (!pass)
                return score;

            // award every unique letter until 5 repetitions
            var letters = new Object();
            for (var i=0; i<pass.length; i++) {
                letters[pass[i]] = (letters[pass[i]] || 0) + 1;
                score += 5.0 / letters[pass[i]];
            }

            // bonus points for mixing it up
            var variations = {
                digits: /\d/.test(pass),
                lower: /[a-z]/.test(pass),
                upper: /[A-Z]/.test(pass),
                nonWords: /\W/.test(pass),
            }

            variationCount = 0;
            for (var check in variations) {
                variationCount += (variations[check] == true) ? 1 : 0;
            }
            score += (variationCount - 1) * 10;

            return parseInt(score);
        }

        function validate(){
            // ... các lệnh validate khác
            const user = $('#username').val();
            const email = $('#email').val();
            const password = $('#password').val();
            const password_cf = $('#password_cf').val();
            if(user== ""){
                alert('Tên đăng nhập không được rỗng.')
                    return false;
            }
            if(user.length < 8 ){
                alert('Tên đăng nhập phải từ 8 ký tự.')
                return false;
            }
            if(user.length > 25 ){
                alert('Tên đăng nhập tối đa 25 ký tự.')
                return false;
            }
            if(!validateEmail(email)){
                alert('Email không hợp lệ.')
                return false;
            }
            if(password == ""){
                alert('Mật khẩu không được rỗng.');
                return false;
            }
            if(password.length < 6){
                alert('Mật khẩu phải lơn hơn 6 ký tự');
                return false;
            }
            if(password.length > 24 ){
                alert('Mật khẩu phải bé hơn 25 ký tự.');
                return false;
            }
            if(scorePassword(password) <=30){
                alert('Mật khẩu yếu.');
                return false;
            }
            if(password_cf == ""){
                alert("Xác nhận mật khẩu rỗng");
                return false;
            }
            if(password_cf != password){
                alert("Xác nhận mật khẩu khác với mật khẩu ở trên.");
                return false;
            }
            var temp=""
            $.getJSON(`/account/register/is-available-email?email=${email}`, function (data) {
                temp=data;
                if (data) {
                    alert('Email đăng ký đã tồn tại.');
                    return false;
                }
            })
            $.getJSON(`/account/register/is-available?user=${user}`, function (data) {
                if (data === false) {
                    if(temp === false){
                        $('#frmRegister').off('submit').submit();
                    }
                    return false;

                } else {
                    alert('Tên đăng nhập đã tồn tại.');
                }
            })
        }
    </script>

{{/section}}


<div class="container" style="margin-top: 50px; margin-bottom:50px">
    <div class="card bg-light">
    <article class="card-body mx-auto" style="width: 50%;">
        <h4 class="card-title mt-3 text-center">Đăng ký</h4>
        <p>
            <a href="" class="btn btn-block btn-twitter"> <i class="fab fa-twitter"></i>  Đăng nhập bằng twitter</a>
            <a href="/account/auth/google" class="btn btn-block btn-google"> <i class="fab fa-google"></i>  Đăng nhập bằng google</a>
        <a href="/account/auth/facebook" class="btn btn-block btn-facebook"> <i class="fab fa-facebook-f"></i> Đăng nhập bằng
            facebook</a>
        </p>
        <p class="divider-text">
            <span class="bg-light">hoặc</span>
        </p>
        <form method="POST"  id="frmRegister"  >
        <div class="form-group input-group">
            <div class="input-group-prepend">
                <span class="input-group-text"> <i class="fa fa-user"></i> </span>
            </div>
            <input name="username" class="form-control" placeholder="Tên đăng nhập" id="username" type="text">
            <div id="name_error"></div>
        </div> <!-- form-group// -->
        <div class="form-group input-group">
            <div class="input-group-prepend">
                <span class="input-group-text"> <i class="fa fa-envelope"></i> </span>
            </div>
            <input class="form-control" placeholder="Địa chỉ email" id="email" name="email">
            <div id="mail_error"></div>
        </div> <!-- form-group// -->

        <div class="form-group input-group">
            <div class="input-group-prepend w-100">
                <span class="input-group-text"> <i class="fa fa-calendar"></i> </span>
                <input required placeholder="__/__/____" type="text" class="form-control" id="txtDOB" name="dob">
            </div>
           
        </div> <!-- form-group end.// -->
        <div class="form-group input-group">
            <div class="input-group-prepend">
                <span class="input-group-text"> <i class="fa fa-lock"></i> </span>
            </div>
            <input class="form-control" placeholder="Mật khẩu" id="password" name="password" type="password">
            <div id="password_error"></div>
        </div> <!-- form-group// -->
        <div class="form-group input-group">
            <div class="input-group-prepend">
                <span class="input-group-text"> <i class="fa fa-lock"></i> </span>
            </div>
            <input class="form-control" id="password_cf" placeholder="Xác nhận lại mật khẩu" type="password">
            <div id="password_cf_error"></div>
        </div> <!-- form-group// -->                                      
        <div class="form-group">
            <button type="submit" class="btn btn-primary btn-block"> Tạo tài khoản  </button>
        </div> <!-- form-group// -->      
        <p class="text-center">Đã có tài khoản? <a style="font-weight: 700;  text-decoration: none;" href="/account/login">Đăng nhập</a> </p>                                                                 
    </form>
    </article>
    </div> <!-- card.// -->

</div> 
